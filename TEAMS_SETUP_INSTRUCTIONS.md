# üèí –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Å–∏—Å—Ç–µ–º—ã –∫–æ–º–∞–Ω–¥

## üìã –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

–°–∏—Å—Ç–µ–º–∞ –∫–æ–º–∞–Ω–¥ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –≤ –∫–æ–¥–µ, –Ω–æ –Ω—É–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å SQL –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö Supabase.

## üöÄ –®–∞–≥–∏ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard
- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://supabase.com/dashboard
- –í–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç
- –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç `hockeystars-app`

### 2. –û—Ç–∫—Ä–æ–π—Ç–µ SQL Editor
- –í –ª–µ–≤–æ–º –º–µ–Ω—é –Ω–∞–π–¥–∏—Ç–µ "SQL Editor"
- –ù–∞–∂–º–∏—Ç–µ "New query" –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞

### 3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç
–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `database/add_teams_support.sql` –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ SQL Editor.

### 4. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã
–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "Run" –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö SQL –∫–æ–º–∞–Ω–¥.

## üìÑ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ SQL —Ñ–∞–π–ª–∞

```sql
-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∫–æ–º–∞–Ω–¥ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –∫–æ–º–∞–Ω–¥
CREATE TABLE teams (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  name VARCHAR(255) NOT NULL UNIQUE,
  type VARCHAR(50) DEFAULT 'club', -- 'club', 'national', 'regional', 'school'
  country VARCHAR(100),
  city VARCHAR(100),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Å–≤—è–∑–∏ –∏–≥—Ä–æ–∫–æ–≤ —Å –∫–æ–º–∞–Ω–¥–∞–º–∏ (–º–Ω–æ–≥–∏–µ –∫–æ –º–Ω–æ–≥–∏–º)
CREATE TABLE player_teams (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  player_id UUID REFERENCES players(id) ON DELETE CASCADE,
  team_id UUID REFERENCES teams(id) ON DELETE CASCADE,
  is_primary BOOLEAN DEFAULT FALSE, -- –æ—Å–Ω–æ–≤–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –∏–≥—Ä–æ–∫–∞
  joined_date DATE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(player_id, team_id)
);

-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
CREATE INDEX idx_teams_name ON teams(name);
CREATE INDEX idx_teams_type ON teams(type);
CREATE INDEX idx_player_teams_player ON player_teams(player_id);
CREATE INDEX idx_player_teams_team ON player_teams(team_id);
CREATE INDEX idx_player_teams_primary ON player_teams(player_id, is_primary);

-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è updated_at –¥–ª—è –∫–æ–º–∞–Ω–¥
CREATE TRIGGER update_teams_updated_at 
  BEFORE UPDATE ON teams 
  FOR EACH ROW 
  EXECUTE FUNCTION update_updated_at_column();

-- –í–∫–ª—é—á–µ–Ω–∏–µ Row Level Security –¥–ª—è –Ω–æ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü
ALTER TABLE teams ENABLE ROW LEVEL SECURITY;
ALTER TABLE player_teams ENABLE ROW LEVEL SECURITY;

-- –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã teams (–≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å, –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å)
CREATE POLICY "Teams are viewable by everyone" ON teams
  FOR SELECT USING (true);

CREATE POLICY "Teams can be inserted by authenticated users" ON teams
  FOR INSERT WITH CHECK (auth.role() = 'authenticated');

-- –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã player_teams
CREATE POLICY "Player teams are viewable by everyone" ON player_teams
  FOR SELECT USING (true);

CREATE POLICY "Players can manage own team associations" ON player_teams
  FOR ALL USING (auth.uid()::text = player_id::text);

-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
INSERT INTO teams (name, type, country, city) VALUES
-- –ö–ª—É–±—ã –ë–µ–ª–∞—Ä—É—Å–∏
('–®–†–°', 'club', '–ë–µ–ª–∞—Ä—É—Å—å', NULL),
('–î–∏–Ω–∞–º–æ', 'club', '–ë–µ–ª–∞—Ä—É—Å—å', NULL),
('–Æ–Ω–æ—Å—Ç—å', 'club', '–ë–µ–ª–∞—Ä—É—Å—å', NULL),
('–ü–∏—Ä–∞–Ω—å–∏', 'club', '–ë–µ–ª–∞—Ä—É—Å—å', NULL),
('–î–∏–Ω–∞–º–æ-–ú–æ–ª–æ–¥–µ—á–Ω–æ', 'club', '–ë–µ–ª–∞—Ä—É—Å—å', '–ú–æ–ª–æ–¥–µ—á–Ω–æ'),
('–ë–∞—Ä–∞–Ω–æ–≤–∏—á–∏', 'club', '–ë–µ–ª–∞—Ä—É—Å—å', '–ë–∞—Ä–∞–Ω–æ–≤–∏—á–∏'),
('–®–∞—Ö—Ç–µ—Ä', 'club', '–ë–µ–ª–∞—Ä—É—Å—å', NULL),
('–ù–µ–º–∞–Ω', 'club', '–ë–µ–ª–∞—Ä—É—Å—å', NULL),
('–ë—Ä–µ—Å—Ç', 'club', '–ë–µ–ª–∞—Ä—É—Å—å', '–ë—Ä–µ—Å—Ç'),
('–õ–∏–¥–∞', 'club', '–ë–µ–ª–∞—Ä—É—Å—å', '–õ–∏–¥–∞'),
('–ü–∏–Ω—Å–∫', 'club', '–ë–µ–ª–∞—Ä—É—Å—å', '–ü–∏–Ω—Å–∫'),
('–ò–≤–∞—Ü–µ–≤–∏—á–∏', 'club', '–ë–µ–ª–∞—Ä—É—Å—å', '–ò–≤–∞—Ü–µ–≤–∏—á–∏'),
('–ë–µ—Ä–µ–∑–∞', 'club', '–ë–µ–ª–∞—Ä—É—Å—å', '–ë–µ—Ä–µ–∑–∞'),
('–ö–æ–±—Ä–∏–Ω', 'club', '–ë–µ–ª–∞—Ä—É—Å—å', '–ö–æ–±—Ä–∏–Ω'),
('–•–∏–º–∏–∫', 'club', '–ë–µ–ª–∞—Ä—É—Å—å', NULL),
('–ñ–ª–æ–±–∏–Ω', 'club', '–ë–µ–ª–∞—Ä—É—Å—å', '–ñ–ª–æ–±–∏–Ω'),
('–ú–æ–≥–∏–ª–µ–≤', 'club', '–ë–µ–ª–∞—Ä—É—Å—å', '–ú–æ–≥–∏–ª–µ–≤'),
('–õ–æ–∫–æ–º–æ—Ç–∏–≤', 'club', '–ë–µ–ª–∞—Ä—É—Å—å', NULL),
('–ë–æ–±—Ä—É–π—Å–∫', 'club', '–ë–µ–ª–∞—Ä—É—Å—å', '–ë–æ–±—Ä—É–π—Å–∫'),
('–ì–æ–º–µ–ª—å', 'club', '–ë–µ–ª–∞—Ä—É—Å—å', '–ì–æ–º–µ–ª—å'),
('–í–∏—Ç–µ–±—Å–∫', 'club', '–ë–µ–ª–∞—Ä—É—Å—å', '–í–∏—Ç–µ–±—Å–∫'),
('–õ—É–Ω–∏–Ω–µ—Ü', 'club', '–ë–µ–ª–∞—Ä—É—Å—å', '–õ—É–Ω–∏–Ω–µ—Ü'),

-- –°–±–æ—Ä–Ω—ã–µ –ë–µ–ª–∞—Ä—É—Å–∏
('–°–±–æ—Ä–Ω–∞—è –†–ë', 'national', '–ë–µ–ª–∞—Ä—É—Å—å', NULL),
('–°–±–æ—Ä–Ω–∞—è –ú–∏–Ω—Å–∫–∞', 'regional', '–ë–µ–ª–∞—Ä—É—Å—å', '–ú–∏–Ω—Å–∫'),
('–°–±–æ—Ä–Ω–∞—è –ú–∏–Ω—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏', 'regional', '–ë–µ–ª–∞—Ä—É—Å—å', '–ú–∏–Ω—Å–∫'),
('–°–±–æ—Ä–Ω–∞—è –ì–æ–º–µ–ª—å—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏', 'regional', '–ë–µ–ª–∞—Ä—É—Å—å', '–ì–æ–º–µ–ª—å'),
('–°–±–æ—Ä–Ω–∞—è –ú–æ–≥–∏–ª–µ–≤—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏', 'regional', '–ë–µ–ª–∞—Ä—É—Å—å', '–ú–æ–≥–∏–ª–µ–≤'),
('–°–±–æ—Ä–Ω–∞—è –ë—Ä–µ—Å—Ç—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏', 'regional', '–ë–µ–ª–∞—Ä—É—Å—å', '–ë—Ä–µ—Å—Ç'),
('–°–±–æ—Ä–Ω–∞—è –ì—Ä–æ–¥–Ω–µ–Ω—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏', 'regional', '–ë–µ–ª–∞—Ä—É—Å—å', '–ì—Ä–æ–¥–Ω–æ'),

-- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ä–æ—Å—Å–∏–π—Å–∫–∏–µ —Ö–æ–∫–∫–µ–π–Ω—ã–µ –∫–ª—É–±—ã
('–¶–°–ö–ê –ú–æ—Å–∫–≤–∞', 'club', '–†–æ—Å—Å–∏—è', '–ú–æ—Å–∫–≤–∞'),
('–î–∏–Ω–∞–º–æ –ú–æ—Å–∫–≤–∞', 'club', '–†–æ—Å—Å–∏—è', '–ú–æ—Å–∫–≤–∞'),
('–°–ø–∞—Ä—Ç–∞–∫ –ú–æ—Å–∫–≤–∞', 'club', '–†–æ—Å—Å–∏—è', '–ú–æ—Å–∫–≤–∞'),
('–õ–æ–∫–æ–º–æ—Ç–∏–≤ –Ø—Ä–æ—Å–ª–∞–≤–ª—å', 'club', '–†–æ—Å—Å–∏—è', '–Ø—Ä–æ—Å–ª–∞–≤–ª—å'),
('–ê–∫ –ë–∞—Ä—Å –ö–∞–∑–∞–Ω—å', 'club', '–†–æ—Å—Å–∏—è', '–ö–∞–∑–∞–Ω—å'),
('–¢—Ä–∞–∫—Ç–æ—Ä –ß–µ–ª—è–±–∏–Ω—Å–∫', 'club', '–†–æ—Å—Å–∏—è', '–ß–µ–ª—è–±–∏–Ω—Å–∫'),
('–°–∞–ª–∞–≤–∞—Ç –Æ–ª–∞–µ–≤', 'club', '–†–æ—Å—Å–∏—è', '–£—Ñ–∞'),
('–ú–µ—Ç–∞–ª–ª—É—Ä–≥ –ú–∞–≥–Ω–∏—Ç–æ–≥–æ—Ä—Å–∫', 'club', '–†–æ—Å—Å–∏—è', '–ú–∞–≥–Ω–∏—Ç–æ–≥–æ—Ä—Å–∫'),
('–°–µ–≤–µ—Ä—Å—Ç–∞–ª—å', 'club', '–†–æ—Å—Å–∏—è', '–ß–µ—Ä–µ–ø–æ–≤–µ—Ü'),
('–¢–æ—Ä–ø–µ–¥–æ –ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥', 'club', '–†–æ—Å—Å–∏—è', '–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥');

-- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥ –∏–≥—Ä–æ–∫–∞
CREATE OR REPLACE FUNCTION get_player_teams(player_uuid UUID)
RETURNS TABLE (
  team_id UUID,
  team_name VARCHAR(255),
  team_type VARCHAR(50),
  team_country VARCHAR(100),
  team_city VARCHAR(100),
  is_primary BOOLEAN,
  joined_date DATE
) AS $$
BEGIN
  RETURN QUERY
  SELECT 
    t.id,
    t.name,
    t.type,
    t.country,
    t.city,
    pt.is_primary,
    pt.joined_date
  FROM player_teams pt
  JOIN teams t ON pt.team_id = t.id
  WHERE pt.player_id = player_uuid
  ORDER BY pt.is_primary DESC, t.name;
END;
$$ LANGUAGE plpgsql;

-- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫–æ–º–∞–Ω–¥ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
CREATE OR REPLACE FUNCTION search_teams(search_term VARCHAR(255))
RETURNS TABLE (
  id UUID,
  name VARCHAR(255),
  type VARCHAR(50),
  country VARCHAR(100),
  city VARCHAR(100)
) AS $$
BEGIN
  RETURN QUERY
  SELECT 
    t.id,
    t.name,
    t.type,
    t.country,
    t.city
  FROM teams t
  WHERE LOWER(t.name) LIKE LOWER('%' || search_term || '%')
  ORDER BY 
    CASE WHEN LOWER(t.name) = LOWER(search_term) THEN 1
         WHEN LOWER(t.name) LIKE LOWER(search_term || '%') THEN 2
         ELSE 3
    END,
    t.name
  LIMIT 10;
END;
$$ LANGUAGE plpgsql;
```

## ‚úÖ –ß—Ç–æ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–æ

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL —Å–∫—Ä–∏–ø—Ç–∞ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã:

1. **–¢–∞–±–ª–∏—Ü–∞ `teams`** - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥
2. **–¢–∞–±–ª–∏—Ü–∞ `player_teams`** - —Å–≤—è–∑–∏ –∏–≥—Ä–æ–∫–æ–≤ —Å –∫–æ–º–∞–Ω–¥–∞–º–∏
3. **–ò–Ω–¥–µ–∫—Å—ã** –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
4. **RLS –ø–æ–ª–∏—Ç–∏–∫–∏** –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
5. **–§—É–Ω–∫—Ü–∏–∏** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–º–∞–Ω–¥–∞–º–∏
6. **–ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** - 30+ —Ö–æ–∫–∫–µ–π–Ω—ã—Ö –∫–æ–º–∞–Ω–¥

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL —Å–∫—Ä–∏–ø—Ç–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É:

```bash
node check_teams_status.js
```

–î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ teams —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ player_teams —Å—É—â–µ—Å—Ç–≤—É–µ—Ç  
- ‚úÖ –§—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- üìä –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–∞–Ω–¥: ~30

## üéØ –ß—Ç–æ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –¥–µ–ª–∞—Ç—å –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

1. **–í—ã–±–∏—Ä–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã** –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è
2. **–ò—Å–∫–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã** —Å –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ–º
3. **–°–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã** –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç –≤ —Å–ø–∏—Å–∫–µ
4. **–í—ã–±–∏—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–º–∞–Ω–¥** (–∫–ª—É–± + —Å–±–æ—Ä–Ω–∞—è + —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω–∞—è)
5. **–ù–∞–∑–Ω–∞—á–∞—Ç—å –æ—Å–Ω–æ–≤–Ω—É—é –∫–æ–º–∞–Ω–¥—É**
6. **–í–∏–¥–µ—Ç—å –∫–æ–º–∞–Ω–¥—ã** –≤ –ø—Ä–æ—Ñ–∏–ª–µ –∏–≥—Ä–æ–∫–∞

## üö® –í–∞–∂–Ω–æ

- –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç **–æ–¥–∏–Ω —Ä–∞–∑**
- –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–æ–≤ –æ—Å—Ç–∞–Ω—É—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π 