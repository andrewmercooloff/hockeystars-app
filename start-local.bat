@echo off
echo ðŸš€ Ð—Ð°Ð¿ÑƒÑÐº Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð¹ ÑÑ€ÐµÐ´Ñ‹ HockeyStars Ð½Ð° Windows...

REM ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ñ MongoDB
where mongod >nul 2>nul
if %errorlevel% neq 0 (
    echo âŒ MongoDB Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½!
    echo ðŸ“¥ Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ MongoDB: https://docs.mongodb.com/manual/installation/
    pause
    exit /b 1
)

REM ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ñ Node.js
where node >nul 2>nul
if %errorlevel% neq 0 (
    echo âŒ Node.js Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½!
    echo ðŸ“¥ Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Node.js: https://nodejs.org/
    pause
    exit /b 1
)

echo âœ… ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°

REM Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¿Ð°Ð¿ÐºÐ¸ Ð´Ð»Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ… MongoDB
if not exist "data\db" mkdir "data\db"

REM Ð—Ð°Ð¿ÑƒÑÐº MongoDB (ÐµÑÐ»Ð¸ Ð½Ðµ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½)
tasklist /FI "IMAGENAME eq mongod.exe" 2>NUL | find /I /N "mongod.exe">NUL
if "%errorlevel%" neq "0" (
    echo ðŸ”„ Ð—Ð°Ð¿ÑƒÑÐº MongoDB...
    start /B mongod --dbpath ./data/db
    timeout /t 3 /nobreak >nul
)

REM Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹ ÑÐµÑ€Ð²ÐµÑ€Ð°
echo ðŸ“¦ Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹ ÑÐµÑ€Ð²ÐµÑ€Ð°...
cd server
if not exist "node_modules" (
    npm install
)

REM Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ .env Ñ„Ð°Ð¹Ð»Ð° ÐµÑÐ»Ð¸ Ð½Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚
if not exist ".env" (
    echo ðŸ“ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ .env Ñ„Ð°Ð¹Ð»Ð°...
    copy env.example .env
    echo âš ï¸  ÐžÑ‚Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ .env Ñ„Ð°Ð¹Ð» Ð² Ð¿Ð°Ð¿ÐºÐµ server/
)

REM Ð—Ð°Ð¿ÑƒÑÐº ÑÐµÑ€Ð²ÐµÑ€Ð°
echo ðŸŒ Ð—Ð°Ð¿ÑƒÑÐº API ÑÐµÑ€Ð²ÐµÑ€Ð°...
start /B npm run dev

cd ..

REM Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°
echo ðŸ“± Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°...
if not exist "node_modules" (
    npm install
)

REM Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ .env Ñ„Ð°Ð¹Ð»Ð° Ð´Ð»Ñ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð° ÐµÑÐ»Ð¸ Ð½Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚
if not exist ".env" (
    echo ðŸ“ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ .env Ñ„Ð°Ð¹Ð»Ð° Ð´Ð»Ñ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°...
    (
        echo EXPO_PUBLIC_API_URL=http://localhost:5000/api
        echo EXPO_PUBLIC_SOCKET_URL=http://localhost:5000
    ) > .env
)

REM Ð—Ð°Ð¿ÑƒÑÐº ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°
echo ðŸ“± Ð—Ð°Ð¿ÑƒÑÐº ÐºÐ»Ð¸ÐµÐ½Ñ‚ÑÐºÐ¾Ð³Ð¾ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ...
npm start

echo ðŸ›‘ ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ Ð»ÑŽÐ±ÑƒÑŽ ÐºÐ»Ð°Ð²Ð¸ÑˆÑƒ Ð´Ð»Ñ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸...
pause >nul

REM ÐžÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð¿Ñ€Ð¾Ñ†ÐµÑÑÐ¾Ð²
taskkill /F /IM node.exe >nul 2>nul
taskkill /F /IM mongod.exe >nul 2>nul 