# Инструкции по настройке базы данных и хранилища

## Шаг 1: Настройка Storage Bucket

Выполните SQL скрипт `database/setup_storage_bucket.sql` в Supabase SQL Editor:

1. Откройте Supabase Dashboard
2. Перейдите в SQL Editor
3. Скопируйте содержимое файла `database/setup_storage_bucket.sql`
4. Вставьте и выполните скрипт

Этот скрипт:
- Создаст bucket 'items' для хранения изображений
- Настроит политики доступа к storage
- Исправит RLS политики для таблицы items
- Добавит недостающие колонки и триггеры

## Шаг 2: Проверка результатов

После выполнения скрипта вы должны увидеть сообщения:
- "Storage bucket и политики настроены!"
- Различные уведомления о создании/обновлении таблиц

## Шаг 3: Тестирование

Теперь попробуйте:
1. Открыть профиль звезды
2. Нажать на одну из кнопок загрузки (автограф, клюшка, шайба, джерси)
3. Выбрать изображение
4. Загрузить предмет

## Возможные проблемы и решения

### Ошибка "Bucket not found"
- Убедитесь, что скрипт `setup_storage_bucket.sql` выполнен успешно
- Проверьте, что bucket 'items' создан в Storage разделе Supabase

### Ошибка RLS политики
- Убедитесь, что пользователь авторизован
- Проверьте, что RLS политики созданы корректно

### Ошибка с avatar_url
- Эта проблема уже исправлена в коде
- Колонка avatar_url будет добавлена автоматически

## Что изменилось в UI

1. **Упрощен интерфейс загрузки** - теперь 4 простые кнопки вместо сложной формы
2. **Убраны поля "Название предмета" и "Описание"** - они больше не нужны
3. **Убрана принудительная квадратная обрезка** изображений
4. **Исправлены ошибки** с avatar_url и RLS политиками

## Следующие шаги

После успешной настройки базы данных:
1. Протестируйте загрузку предметов
2. Проверьте, что предметы отображаются в списке
3. Протестируйте запросы от игроков
4. Проверьте работу музея

Если возникнут проблемы, проверьте консоль браузера и логи Supabase для диагностики.

