# üîç –û—Ç–ª–∞–¥–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–æ–≤

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

–ö–æ–≥–¥–∞ –≤—ã –∑–∞–≥—Ä—É–∂–∞–µ—Ç–µ –Ω–æ–≤—ã–π –∞–≤–∞—Ç–∞—Ä –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏, –æ–Ω —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø—É—Å—Ç—ã–º –Ω–∞ –¥—Ä—É–≥–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö.

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏

–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–æ–≤–æ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏:

1. **–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞** –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
2. **–ó–∞–≥—Ä—É–∑–∏—Ç–µ –Ω–æ–≤—ã–π –∞–≤–∞—Ç–∞—Ä**
3. **–ù–∞–π–¥–∏—Ç–µ –ª–æ–≥–∏** —Å –ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏:
   - `üì§ –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ Supabase Storage...`
   - `‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ:`
   - `‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤ Storage:`

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç

**–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –ª–æ–≥–∏ –∑–∞–≥—Ä—É–∑–∫–∏:**
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `uploadImageToStorage` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ª–∏ –æ–Ω–∞ URL –∏–ª–∏ `null`

**–ï—Å–ª–∏ –ù–ï –≤–∏–¥–∏—Ç–µ –ª–æ–≥–∏ –∑–∞–≥—Ä—É–∑–∫–∏:**
- ‚ùå –§—É–Ω–∫—Ü–∏—è `uploadImageToStorage` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
- –ü—Ä–æ–±–ª–µ–º–∞ –≤ –∫–æ–¥–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## üîß –í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### –†–µ—à–µ–Ω–∏–µ 1: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤ Storage

–ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è, –¥–æ–±–∞–≤—å—Ç–µ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É –≤ `profile.tsx`:

```typescript
const pickFromGallery = async () => {
  if (!currentUser) {
    Alert.alert('–û—à–∏–±–∫–∞', '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω');
    return;
  }

  const result = await ImagePicker.launchImageLibraryAsync({
    mediaTypes: ImagePicker.MediaTypeOptions.Images,
    allowsEditing: true,
    aspect: [1, 1],
    quality: 0.8,
  });

  if (!result.canceled && result.assets[0]) {
    console.log('üì∏ –§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ –∏–∑ –≥–∞–ª–µ—Ä–µ–∏:', result.assets[0].uri);
    
    // –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û –∑–∞–≥—Ä—É–∂–∞–µ–º –≤ Storage
    try {
      const { uploadImageToStorage } = await import('../utils/uploadImage');
      const uploadedUrl = await uploadImageToStorage(result.assets[0].uri);
      
      if (uploadedUrl) {
        console.log('‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ –≤ Storage:', uploadedUrl);
        setEditData({...editData, avatar: uploadedUrl});
        setCurrentUser({...currentUser, avatar: uploadedUrl});
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
        const updatedUser = { ...currentUser, avatar: uploadedUrl };
        await updatePlayer(currentUser.id, updatedUser);
        await saveCurrentUser(updatedUser);
        
        showAlert('–£—Å–ø–µ—à–Ω–æ', '–§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ', 'success');
      } else {
        console.error('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤ Storage');
        showAlert('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ –≤ –æ–±–ª–∞–∫–æ', 'error');
      }
    } catch (error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
      showAlert('–û—à–∏–±–∫–∞', '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–æ—Ç–æ', 'error');
    }
  }
};
```

### –†–µ—à–µ–Ω–∏–µ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ bucket

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ bucket `avatars` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –¥–æ—Å—Ç—É–ø–µ–Ω:

```sql
-- –í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ SQL Editor –≤ Supabase Dashboard
SELECT * FROM storage.buckets WHERE name = 'avatars';
```

### –†–µ—à–µ–Ω–∏–µ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–∏—Ç–∏–∫

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

```sql
-- –í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ SQL Editor –≤ Supabase Dashboard
SELECT policyname, cmd FROM pg_policies 
WHERE tablename = 'objects' AND schemaname = 'storage';
```

## üìã –ß–µ–∫-–ª–∏—Å—Ç –æ—Ç–ª–∞–¥–∫–∏

- [ ] –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∞–≤–∞—Ç–∞—Ä–∞
- [ ] –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ bucket `avatars` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [ ] –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ Storage
- [ ] –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è `uploadImageToStorage` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
- [ ] –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç URL, –∞ –Ω–µ `null`
- [ ] –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ URL —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

## üéØ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ –ù–æ–≤—ã–µ –∞–≤–∞—Ç–∞—Ä—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ Supabase Storage
- ‚úÖ URL —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ê–≤–∞—Ç–∞—Ä—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏
- ‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –Ω–∞ –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–µ—Ç—Å—è:
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ –ª–æ–≥–∏ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∞–≤–∞—Ç–∞—Ä–∞
- –£–∫–∞–∂–∏—Ç–µ, –Ω–∞ –∫–∞–∫–æ–º —ç—Ç–∞–ø–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ—à–∏–±–∫–∞
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –æ—à–∏–±–æ–∫ 