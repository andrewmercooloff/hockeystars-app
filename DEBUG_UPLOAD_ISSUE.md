# üîç –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–≥—Ä—É–∑–∫–æ–π –∞–≤–∞—Ç–∞—Ä–æ–≤

## üö® –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤–æ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏, –æ–Ω —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–∞–∫ **–ª–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª** –≤–º–µ—Å—Ç–æ –∑–∞–≥—Ä—É–∑–∫–∏ –≤ Supabase Storage.

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ —Ñ–∞–π–ª–µ `utils/uploadImage.ts` –µ—Å—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

```typescript
// –û—á–∏—â–∞–µ–º –∏–º—è —Ñ–∞–π–ª–∞ –æ—Ç –ª–∏—à–Ω–∏—Ö —Å–ª–µ—à–µ–π
finalFileName = finalFileName.replace(/^\/+/, '').replace(/\/+$/, '');

// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ—Ç –ª–∏ –¥–≤–æ–π–Ω—ã—Ö —Å–ª–µ—à–µ–π –≤ URL
if (publicUrl.includes('avatars//')) {
  console.error('‚ùå –û–ë–ù–ê–†–£–ñ–ï–ù –î–í–û–ô–ù–û–ô –°–õ–ï–® –í URL!');
  console.error('URL:', publicUrl);
  return null;
}
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∞–≤–∞—Ç–∞—Ä–∞

–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–æ–≤–æ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –ª–æ–≥–∏:

```
LOG  üì§ –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ Supabase Storage...
LOG  üìÅ –í—Ö–æ–¥–Ω–æ–π URI: file://...
LOG  üìÅ –ò–º—è —Ñ–∞–π–ª–∞: avatar_[timestamp].jpg
LOG  ‚úÖ Blob —Å–æ–∑–¥–∞–Ω, —Ä–∞–∑–º–µ—Ä: [—á–∏—Å–ª–æ] –±–∞–π—Ç
LOG  ‚úÖ –§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω –≤ Storage
LOG  ‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ: https://...
```

**–ï—Å–ª–∏ —ç—Ç–∏—Ö –ª–æ–≥–æ–≤ –Ω–µ—Ç** - —Ñ—É–Ω–∫—Ü–∏—è `uploadImageToStorage` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–ª–∏ –ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π.

### 3. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã

1. **–ö—ç—à –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** - –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é
2. **Hot reload –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–ª –∏–∑–º–µ–Ω–µ–Ω–∏—è** - –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Metro bundler
3. **–û—à–∏–±–∫–∞ –≤ —Ñ—É–Ω–∫—Ü–∏–∏** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –æ—à–∏–±–∫–∏
4. **–ü—Ä–æ–±–ª–µ–º–∞ —Å bucket** - —Ñ—É–Ω–∫—Ü–∏—è `ensureAvatarsBucket` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `false`

## üîß –†–µ—à–µ–Ω–∏–µ

### –®–∞–≥ 1: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (Ctrl+C)
# –ó–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–Ω–æ–≤–æ
npx expo start --clear
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∞–≤–∞—Ç–∞—Ä–∞ —Å–ª–µ–¥–∏—Ç–µ –∑–∞ –∫–æ–Ω—Å–æ–ª—å—é. –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –ª–æ–≥–∏ –∏–∑ `uploadImageToStorage`.

### –®–∞–≥ 3: –ï—Å–ª–∏ –ª–æ–≥–∏ –Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ `app/profile.tsx`:

```typescript
const uploadedUrl = await uploadImageToStorage(result.assets[0].uri);
console.log('üì§ –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–≥—Ä—É–∑–∫–∏:', uploadedUrl);
```

### –®–∞–≥ 4: –ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –æ—à–∏–±–∫–∏ —Ç–∏–ø–∞:
- `‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å bucket avatars`
- `‚ùå –û—à–∏–±–∫–∞ fetch`
- `‚ùå Blob –ø—É—Å—Ç–æ–π`

## üéØ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
1. ‚úÖ –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∞–≤–∞—Ç–∞—Ä–∞ –ø–æ—è–≤–ª—è—é—Ç—Å—è –ª–æ–≥–∏
2. ‚úÖ –ê–≤–∞—Ç–∞—Ä –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ Storage
3. ‚úÖ –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è HTTP URL
4. ‚úÖ –ê–≤–∞—Ç–∞—Ä –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö

## üìû –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–µ—Ç—Å—è

–ï—Å–ª–∏ –ª–æ–≥–∏ –Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è –∏–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ:
1. –õ–æ–≥–∏ –∫–æ–Ω—Å–æ–ª–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∞–≤–∞—Ç–∞—Ä–∞
2. –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `utils/uploadImage.ts`
3. –û—à–∏–±–∫–∏ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ Metro bundler 